import{a as I,r as v,R as A,S as B,o as j,g as R,h as k,d as U,v as $,s as P,$ as z,ao as D,ah as N,ap as L,a1 as M,a2 as O,a4 as T,a5 as K,a6 as g,a7 as u,a8 as _,aq as G,ar as H,ai as Q,aj as q,D as J,as as W}from"./index-BIYzBMTl.js";import{Q as X}from"./QPageContainer-Bu73qoPd.js";import{_ as Y,d as Z,e as ee,U as ae}from"./PrimaryButton.vue_vue_type_script_setup_true_lang-CfsqfTCN.js";import{N as oe,a as te}from"./utils-CW8GjlMf.js";import{V as F}from"./validator-76w0UNgc.js";import"./index-B1hcKvQO.js";const se=I({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(d,{slots:p,emit:m}){const b=R(),n=v(null);let l=0;const r=[];function y(e){const f=typeof e=="boolean"?e:d.noErrorFocus!==!0,x=++l,S=(a,s)=>{m(`validation${a===!0?"Success":"Error"}`,s)},w=a=>{const s=a.validate();return typeof s.then=="function"?s.then(i=>({valid:i,comp:a}),i=>({valid:!1,comp:a,err:i})):Promise.resolve({valid:s,comp:a})};return(d.greedy===!0?Promise.all(r.map(w)).then(a=>a.filter(s=>s.valid!==!0)):r.reduce((a,s)=>a.then(()=>w(s).then(i=>{if(i.valid===!1)return Promise.reject(i)})),Promise.resolve()).catch(a=>[a])).then(a=>{if(a===void 0||a.length===0)return x===l&&S(!0),!0;if(x===l){const{comp:s,err:i}=a[0];if(i!==void 0&&console.error(i),S(!1,s),f===!0){const C=a.find(({comp:E})=>typeof E.focus=="function"&&$(E.$)===!1);C!==void 0&&C.comp.focus()}}return!1})}function h(){l++,r.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function c(e){e!==void 0&&P(e);const f=l+1;y().then(x=>{f===l&&x===!0&&(d.onSubmit!==void 0?m("submit",e):(e==null?void 0:e.target)!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function t(e){e!==void 0&&P(e),m("reset"),z(()=>{h(),d.autofocus===!0&&d.noResetFocus!==!0&&o()})}function o(){D(()=>{if(n.value===null)return;const e=n.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||n.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||n.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(n.value.querySelectorAll("[tabindex]"),f=>f.tabIndex!==-1);e==null||e.focus({preventScroll:!0})})}N(L,{bindComponent(e){r.push(e)},unbindComponent(e){const f=r.indexOf(e);f!==-1&&r.splice(f,1)}});let V=!1;return A(()=>{V=!0}),B(()=>{V===!0&&d.autofocus===!0&&o()}),j(()=>{d.autofocus===!0&&o()}),Object.assign(b.proxy,{validate:y,resetValidation:h,submit:c,reset:t,focus:o,getValidationComponents:()=>r}),()=>k("form",{class:"q-form",ref:n,onSubmit:c,onReset:t},U(p.default))}}),ne={class:"flex column justify-center items-center custom_z"},le={class:"row q-mb-md justify-between"},ve=M({__name:"LoginPage",setup(d){const p=v(""),m=v(""),b=v(!0),n=v(!1),l=v(!1),r=O(),y=v(!1),h=async()=>{n.value=!0,await ee.login(p.value,m.value).then(()=>{l.value?localStorage.setItem("email",btoa(p.value)):localStorage.removeItem("email"),r.push("/dashboard/segmentos")}).catch(c=>{console.log(c.message),c instanceof ae?(y.value=!0,oe.error(c.message)):te.show("Erro",c.message)}).finally(()=>{n.value=!1,setTimeout(()=>{y.value=!1},6e3)})};return(c,t)=>(K(),T(Z,null,{default:g(()=>[u(X,{class:"page_padding custom_center flex bg-page window-height relative-position"},{default:g(()=>[_("div",ne,[t[4]||(t[4]=_("span",{class:"agro_text mt-lg"},"AgroSafe",-1)),u(G,{class:"login__cards default-box-shadow big-border-radius"},{default:g(()=>[u(H,{class:"login__card flex-grow justify-center"},{default:g(()=>[u(se,{ref:"myForm",onSubmit:h,style:{width:"60%"}},{default:g(()=>[u(Q,{standard:"",class:"q-mb-md",modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=o=>p.value=o),label:"E-mail",autocomplete:"username",rules:[o=>q(F).isValidEmail(o)||"Por favor, insira um e-mail válido"],"lazy-rules":""},null,8,["modelValue","rules"]),u(Q,{standard:"",class:"q-mb-md",modelValue:m.value,"onUpdate:modelValue":t[2]||(t[2]=o=>m.value=o),label:"Senha",type:b.value?"password":"text",autocomplete:"current-password",rules:[o=>q(F).isValidPassword(o)||"Por favor, insira uma senha válida"],"lazy-rules":""},{append:g(()=>[u(J,{name:b.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[1]||(t[1]=o=>b.value=!b.value),color:"primary"},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),_("div",le,[u(W,{modelValue:l.value,"onUpdate:modelValue":t[3]||(t[3]=o=>l.value=o),label:"Lembrar e-mail",color:"primary"},null,8,["modelValue"])]),u(Y,{loading:n.value,label:"Entrar","btn-type":"submit",rounded:"",class:"full-width"},null,8,["loading"])]),_:1},512)]),_:1})]),_:1})])]),_:1})]),_:1}))}});export{ve as default};
